# Development Tips
:toc:

## Spring JPA

### Supported keywords inside method names

[cols="keyword,sample,jpql_snippet"]
|===
| Keyword | Sample | JPQL Snippet

| Distinct | findDistinctByLastnameAndFirstname | select distinct ... where x.lastname = ?1 and x.firstname = ?2
| And | findByLastnameAndFirstname | ... where x.lastname = ?1 and x.firstname = ?2
| Or | findByLastnameOrFirstname | ... where x.lastname = ?1 or x.firstname = ?2
| Is, Equals | findByFirstname,findByFirstnameIs,findByFirstnameEquals | â€¦ where x.firstname = ?1
| Between | findByStartDateBetween | ... where x.startDate between ?1 and ?2
| LessThan | findByAgeLessThan | ... where x.age < ?1
| LessThanEqual |  findByAgeLessThanEqual | ... where x.age <= ?1
| GreaterThan | findByAgeGreaterThan | ... where x.age > ?1
| GreaterThanEqual | findByAgeGreaterThanEqual | ... where x.age >= ?1
| After | findByStartDateAfter | ... where x.startDate > ?1
| Before | findByStartDateBefore | ... where x.startDate < ?1
| IsNull, Null | findByAge(Is)Null | ... where x.age is null
| IsNotNull, NotNull | findByAge(Is)NotNull | ... where x.age not null
| Like | findByFirstnameLike | ... where x.firstname like ?1
| NotLike | findByFirstnameNotLike | ... where x.firstname not like ?1
| StartingWith | findByFirstnameStartingWith | ... where x.firstname like ?1 (parameter bound with appended %)
| EndingWith | findByFirstnameEndingWith | ... where x.firstname like ?1 (parameter bound with prepended %)
| Containing | findByFirstnameContaining | ... where x.firstname like ?1 (parameter bound wrapped in %)
| OrderBy | findByAgeOrderByLastnameDesc | ... where x.age = ?1 order by x.lastname desc
| Not | findByLastnameNot | ... where x.lastname <> ?1
| In | findByAgeIn(Collection<Age> ages) | ... where x.age in ?1
| NotIn | findByAgeNotIn(Collection<Age> ages) | ... where x.age not in ?1
| True | findByActiveTrue() | ... where x.active = true
| False | findByActiveFalse() | ... where x.active = false
| IgnoreCase | findByFirstnameIgnoreCase | ... where UPPER(x.firstname) = UPPER(?1)
|===

## Test

### Review database status after test

Change test class annotations.

* Replace `@Rollback` annotation with `@Commit`
* Remove `@AutoConfigureTestDatabase`

Create `test/resources/application.properties` with the DB connection details:

```properties
spring.datasource.url=jdbc:h2:file:./test-workspace/workspace/database/store
spring.datasource.username=sa
spring.datasource.password=
spring.datasource.driver-class-name=org.h2.Driver
```

Add the `@PropertySource` annotation to test configuration pointing to the new `application.properties` file.

Once the test is executed, you can access to the resulting DB with a SQL client (DBeaver, SQuirreL SQL...)

**Test class example:**

```java
@ExtendWith(SpringExtension.class)
@ContextConfiguration(loader = AnnotationConfigContextLoader.class)
@Transactional
@Commit
@AutoConfigureCache
@AutoConfigureDataJpa
@AutoConfigureTestEntityManager
@TestPropertySource(properties = {
        "spring.liquibase.change-log=classpath:db/changelogs/core/test/content/item_management_service_tests.xml"
})
public class ItemManagementServiceTests
{
    // . . .

    /*---------------------------*
     * SETUP AND HELPERS
     *---------------------------*/
    @TestConfiguration
    @ComponentScan(basePackageClasses = ICorePackage.class)
    @EnableJpaRepositories(basePackageClasses = {
            IItemRepository.class,
            IH2DbRepository.class
    })
    @EntityScan(basePackageClasses = {
            // content
            Item.class
    })
    @PropertySource("application.properties")
    static class TestConfig
    {

    }
}
```

